## 动态SQL
* if 判断
* choose （when，otherwise）分支选择，带了break的switch-case
* trim 字符串截取(where(封装查询条件),set(封装修改条件))
* foreach
### 携带了哪个字段查询条件就带上这个字段的值
* EmployeeMapperDynamicSQL.java
```
public interface EmployeeMapperDynamicSQL {
	//	携带了哪个字段条件就带上这个字段的值
	List<Employee> getEmpsByConditionIf(Employee employee);
}

```
* EmployeeMapperDynamicSQL.xml
```
<mapper namespace="com.yingxs.mybatis.dao.EmployeeMapperDynamicSQL">

	<!-- 查询员工 要求，携带了哪个字段查询条件就带上这个字段的值  -->
	<!-- List<Employee> getEmpsByConditionIf(Employee employee); -->
	<select id="getEmpsByConditionIf" resultType="com.yingxs.mybatis.bean.Employee">
		select * from tbl_employee 
		where 1=1
		<!-- test:判断表达式（OGNL）
			从参数中取值判断
		  -->
		  <if test="id!=null">
		  	 and id=#{id}
		  </if>
		  <if test="lastName!=null &amp;&amp; lastName!=&quot;&quot;">
		 	 and last_name like #{lastName}
		  </if>
		  <if test="email!=null and email.trim()!=&quot;&quot;">
		 	 and email=#{email}
		  </if>
		  <!-- ognl会进行字符串与数字的转换判断  -->
		  <if test="gender==0 or gender==1">
		 	 and gender=#{gender}
		  </if>
		  
		  
	</select>
</mapper>
```
* Test
```
@Test
	public void testDynamicSql() throws IOException {
		SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();
		SqlSession openSession = sqlSessionFactory.openSession();
		
		try {
			EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL.class);
			Employee employee = new Employee();
			employee.setId(4);
			employee.setEmail("jack@126.com");
			employee.setLastName("%e%");
			
			List<Employee> emps = mapper.getEmpsByConditionIf(employee);
			for (Employee emp : emps) {
				System.out.println(emp);
			}
			
			
		}finally {
			openSession.close();
		}
	}
	

```

### 动态SQl，字符串截取
* EmployeeMapperDynamicSQL.java
```
List<Employee> getEmpsByConditionTrim(Employee employee);
```
* EmployeeMapperDynamicSQL.xml
```
<!-- List<Employee> getEmpsByConditionTrim(Employee employee); -->
<select id="getEmpsByConditionTrim" resultType="com.yingxs.mybatis.bean.Employee">
	select * from tbl_employee 
	<!-- 后面多余的and或者or where不能解决
		prefix="":前缀，给拼串后的整个字符串加一个前缀
		prefixOverrides="":前缀覆盖，去掉整个字符串前面多余的部分
		suffix="":后缀，给拼串后的整个字符串加一个后缀
	  	suffixOverrides="":后缀覆盖，去掉整个字符串后面多余的部分
		
	
	 -->
	 <!-- 字符串的截取规则  -->
	<trim prefix="where" suffixOverrides="and" > 
	  <if test="id!=null">
	  	  id=#{id} and
	  </if>
	  <if test="lastName!=null &amp;&amp; lastName!=&quot;&quot;">
	 	  last_name like #{lastName} and
	  </if>
	  <if test="email!=null and email.trim()!=&quot;&quot;">
	 	  email=#{email} and
	  </if>
	  <!-- ognl会进行字符串与数字的转换判断  -->
	  <if test="gender==0 or gender==1">
	 	  gender=#{gender}
	  </if>
  </trim>
</select>
```
* Test
```
@Test
public void testDynamicSql() throws IOException {
	SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();
	SqlSession openSession = sqlSessionFactory.openSession();
	
	try {
		EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL.class);
		Employee employee = new Employee();
//			employee.setId(4);
//			employee.setEmail("jack@126.com");
		employee.setLastName("%e%");
		
		//测试Time
		List<Employee> emps = mapper.getEmpsByConditionTrim(employee);
		for (Employee emp : emps) {
			System.out.println(emp);
		}
		
		
	}finally {
		openSession.close();
	}
}

	
```


### 动态SQl，分支选择
* EmployeeMapperDynamicSQL.java
```
List<Employee> getEmpsByConditionChoose(Employee employee);
```

* EmployeeMapperDynamicSQL.xml
```
<!-- 如果携带了id就用id查，如果带了lastName就用lastName查，只使用一个条件 -->
<!-- List<Employee> getEmpsByConditionChoose(Employee employee); -->
<select id="getEmpsByConditionChoose" resultType="com.yingxs.mybatis.bean.Employee">
	select * from tbl_employee 
	<where>
		<choose>
			<when test="id!=null">
				id=#{id}
			</when>
			<when test="lastName!=null">
				last_name like #{lastName}
			</when>
			<when test="email!=null">
				email=#{email}
			</when>
			<otherwise>
				gender=0
			</otherwise>
		</choose>
	</where>
</select>
```

* Test
```
@Test
public void testDynamicSql() throws IOException {
	SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();
	SqlSession openSession = sqlSessionFactory.openSession();
	
	try {
		EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL.class);
		Employee employee = new Employee();
//			employee.setId(4);
//			employee.setEmail("jack@126.com");
//			employee.setLastName("%e%");
		
		//测试choose
		List<Employee> emps = mapper.getEmpsByConditionChoose(employee);
		for (Employee emp : emps) {
			System.out.println(emp);
		}
		
		
	}finally {
		openSession.close();
	}
}
	
	
```

### 动态SQL，set

* EmployeeMapperDynamicSQL.java
```
void updateEmp(Employee employee);
```
* EmployeeMapperDynamicSQL.xml
```
<!-- void updateEmp(Employee employee); -->
<update id="updateEmp">
<!-- 
 	方式一 :(推荐)	-->
 	
	update tbl_employee
	<set>
		<if test="lastName!=null">
			last_name=#{lastName},
		</if>
		<if test="email!=null">
			email=#{email},
		</if>
		<if test="gender!=null">
			gender=#{gender},
		</if>
	</set> 
	where id=#{id}


<!-- 方式二：	
	update tbl_employee
	<trim prefix="set" suffixOverrides=",">
		<if test="lastName!=null">
			last_name=#{lastName},
		</if>
		<if test="email!=null">
			email=#{email},
		</if>
		<if test="gender!=null">
			gender=#{gender},
		</if>
	</trim>
	where id=#{id}
	-->
	
</update>
```
* Test
```
@Test
public void testDynamicSql() throws IOException {
	SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();
	SqlSession openSession = sqlSessionFactory.openSession();
	
	try {
		EmployeeMapperDynamicSQL mapper = openSession.getMapper(EmployeeMapperDynamicSQL.class);
		Employee employee = new Employee();
		employee.setId(1);
//		employee.setEmail("jack@126.com");
		employee.setLastName("Admin");
		
		mapper.updateEmp(employee);
		openSession.commit();
		
	}finally {
		openSession.close();
	}
}
```